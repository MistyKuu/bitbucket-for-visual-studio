<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
  <Target Name="GenerateVersionFiles" AfterTargets="PrepareForBuild">
    <Exec Command="git rev-parse HEAD" ConsoleToMSBuild="true" Condition="'$(build_number)'==''">
      <Output PropertyName="LocalGitCommit" TaskParameter="ConsoleOutput" />
    </Exec>

    <PropertyGroup>
      <RevisionNumber>$([System.DateTime]::Now.ToString("%y"))$([System.DateTime]::Now.DayOfYear.ToString("000"))</RevisionNumber>
      <BuildNumber>$([System.DateTime]::Now.ToString("HHmm"))</BuildNumber>

      <VersionLines>
        <![CDATA[     
// <auto-generated /> 
[assembly: System.Reflection.AssemblyVersion("1.0.$(RevisionNumber).$(BuildNumber)")]
[assembly: System.Reflection.AssemblyInformationalVersion("$(LocalGitCommit)")]
      ]]>
      </VersionLines>
    </PropertyGroup>

    <WriteLinesToFile File="AssemblyVersionInfo.cs" ContinueOnError="true" Lines="$(VersionLines)" Overwrite="true" />
  </Target>
</Project>